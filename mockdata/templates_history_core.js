(function(global){
    'use strict';

    function init() {
        const G = global.RigorousGenerator || (window.global && window.global.RigorousGenerator);
        if (!G || !G.registerTemplate) { setTimeout(init, 100); return; }
        const { pick, shuffle } = G.utils;

        // ==========================================
        // æ­·å²ç§‘æ ¸å¿ƒè³‡æ–™åº« (History Core Database)
        // ==========================================
        const historyDB = [
            // ... (keeping your database intact) ...
            // [æ­·å² - å°ç£å²]
              { s:"æ­·å²", t:["åœ‹ä¸ƒ","å°ç£å²"], e:"é•·æ¿±æ–‡åŒ–", y:"èˆŠçŸ³å™¨æ™‚ä»£", p:"æ—©æœŸäººé¡", k:"å…«ä»™æ´", d:"å°ç£å·²çŸ¥æœ€æ—©çš„å²å‰æ–‡åŒ–ï¼Œä»¥æ•²æ‰“çŸ³å™¨ç‚ºä¸»ï¼Œå·²çŸ¥ç”¨ç«" },
        { s:"æ­·å²", t:["åœ‹ä¸ƒ","å°ç£å²"], e:"å¤§åŒå‘æ–‡åŒ–", y:"æ–°çŸ³å™¨æ—©æœŸ", p:"å—å³¶èªæ—ç¥–å…ˆ", k:"ç¹©ç´‹é™¶", d:"å°ç£æœ€æ—©çš„æ–°çŸ³å™¨æ–‡åŒ–ï¼Œé–‹å§‹æœ‰è¾²æ¥­èˆ‡å®šå±…ç”Ÿæ´»" },
        { s:"æ­·å²", t:["åœ‹ä¸ƒ","å°ç£å²"], e:"å‘å—æ–‡åŒ–", y:"æ–°çŸ³å™¨æ™šæœŸ", p:"å²å‰äººé¡", k:"çŸ³æ¿æ£º", d:"å…·æœ‰ç²¾ç¾çš„ç‰å™¨é™ªè‘¬å“ï¼Œé¡¯ç¤ºå·²æœ‰ç¤¾æœƒéšç´š" },
        { s:"æ­·å²", t:["åœ‹ä¸ƒ","å°ç£å²"], e:"åä¸‰è¡Œæ–‡åŒ–", y:"é‡‘å±¬å™¨æ™‚ä»£", p:"å‡±é”æ ¼è˜­æ—ç¥–å…ˆ", k:"ç…‰éµ", d:"å°ç£é€²å…¥é‡‘å±¬å™¨æ™‚ä»£çš„ä»£è¡¨ï¼Œç™¼ç¾ä¾†è‡ªä¸­åœ‹çš„éŠ…éŒ¢" },
        { s:"æ­·å²", t:["åœ‹ä¸ƒ","å°ç£å²"], e:"è·è˜­æ²»å°", y:"1624-1662", p:"è·è˜­æ±å°åº¦å…¬å¸", k:"ç†±è˜­é®åŸ", d:"ä»¥å°ç£ç‚ºè½‰å£è²¿æ˜“ç«™ï¼Œè¼¸å‡ºé¹¿çš®ã€è”—ç³–ï¼Œå¼•å…¥é»ƒç‰›" },
        { s:"æ­·å²", t:["åœ‹ä¸ƒ","å°ç£å²"], e:"è¥¿ç­ç‰™æ²»å°", y:"1626-1642", p:"è¥¿ç­ç‰™äºº", k:"è–è–©çˆ¾ç“¦å¤šåŸ", d:"ä½”é ˜åŒ—å°ç£ï¼Œæ¨å»£å¤©ä¸»æ•™ï¼Œå¾Œè¢«è·è˜­äººé©…é€" },
        { s:"æ­·å²", t:["åœ‹ä¸ƒ","å°ç£å²"], e:"é„­æ°æ²»å°", y:"1661-1683", p:"é„­æˆåŠŸ", k:"å…¨å°é¦–å­¸", d:"å»ºç«‹å°ç£ç¬¬ä¸€å€‹æ¼¢äººæ”¿æ¬Šï¼Œé™³æ°¸è¯å»ºç«‹å­”å»Ÿæ¨å‹•å„’å­¸" },
        { s:"æ­·å²", t:["åœ‹å…«","å°ç£å²"], e:"æ¸¡å°ç¦ä»¤", y:"æ¸…é ˜å‰æœŸ", p:"åº·ç†™çš‡å¸", k:"ç¾…æ¼¢è…³", d:"é™åˆ¶æ¼¢äººä¾†å°ï¼Œå°è‡´å°ç£ç”·å¤šå¥³å°‘ï¼Œç¤¾æœƒå‹•ç›ª" },
        { s:"æ­·å²", t:["åœ‹å…«","å°ç£å²"], e:"æ—çˆ½æ–‡äº‹ä»¶", y:"1786", p:"æ—çˆ½æ–‡", k:"å¤©åœ°æœƒ", d:"æ¸…é ˜æ™‚æœŸè¦æ¨¡æœ€å¤§çš„æ°‘è®Šï¼Œè«¸ç¾…ç¸£å› æ­¤æ”¹åå˜‰ç¾©" },
        { s:"æ­·å²", t:["åœ‹å…«","å°ç£å²"], e:"é–‹æ¸¯é€šå•†", y:"1860", p:"è‹±æ³•è¯è»", k:"èŒ¶ã€ç³–ã€æ¨Ÿè…¦", d:"å°ç£ç´å…¥ä¸–ç•Œç¶“æ¿Ÿé«”ç³»ï¼Œç¶“æ¿Ÿé‡å¿ƒç”±å—è½‰åŒ—" },
        { s:"æ­·å²", t:["åœ‹å…«","å°ç£å²"], e:"ç‰¡ä¸¹ç¤¾äº‹ä»¶", y:"1874", p:"æ—¥æœ¬/æ²ˆè‘†æ¥¨", k:"é–‹å±±æ’«ç•ª", d:"æ—¥æœ¬è—‰å£ç‰çƒèˆ¹æ°‘é‡å®³çŠ¯å°ï¼Œæ¸…å»·æ²»å°æ…‹åº¦è½‰ç©æ¥µ" },
        { s:"æ­·å²", t:["åœ‹å…«","å°ç£å²"], e:"ä¸­æ³•æˆ°çˆ­", y:"1884", p:"åŠ‰éŠ˜å‚³", k:"å°ç£å»ºçœ", d:"æ³•è»æ”»æ‰“åŸºéš†æ·¡æ°´ï¼Œæˆ°å¾Œæ¸…å»·å®£å¸ƒå°ç£å»ºçœ" },
        { s:"æ­·å²", t:["åœ‹å…«","å°ç£å²"], e:"ä¹™æœªæˆ°çˆ­", y:"1895", p:"å”æ™¯å´§", k:"å°ç£æ°‘ä¸»åœ‹", d:"é¦¬é—œæ¢ç´„å‰²è®“å°ç£ï¼Œå°ç£äººæ°‘è‡ªç™¼æ€§æ­¦è£æŠ—æ—¥" },
        { s:"æ­·å²", t:["åœ‹å…«","å°ç£å²"], e:"å™å§å“–äº‹ä»¶", y:"1915", p:"ä½™æ¸…èŠ³", k:"è¥¿ä¾†åºµ", d:"æ—¥æ²»æ™‚æœŸè¦æ¨¡æœ€å¤§çš„æ¼¢äººæ­¦è£æŠ—æ—¥ï¼Œå¾Œè½‰ç‚ºéæ­¦è£æŠ—çˆ­" },
        { s:"æ­·å²", t:["åœ‹å…«","å°ç£å²"], e:"éœ§ç¤¾äº‹ä»¶", y:"1930", p:"è«é‚£é­¯é“", k:"è³½å¾·å…‹æ—", d:"åŸä½æ°‘ä¸æ»¿æ—¥æœ¬é«˜å£“çµ±æ²»çˆ†ç™¼çš„æ­¦è£æŠ—çˆ­" },
        { s:"æ­·å²", t:["åœ‹ä¹","å°ç£å²"], e:"å°ç£è­°æœƒè¨­ç½®è«‹é¡˜", y:"1921-1934", p:"æ—ç»å ‚", k:"å°ç£æ–‡åŒ–å”æœƒ", d:"æ—¥æ²»æ™‚æœŸæ­·æ™‚æœ€ä¹…çš„æ”¿æ²»ç¤¾æœƒé‹å‹•" },
        { s:"æ­·å²", t:["åœ‹ä¹","å°ç£å²"], e:"çš‡æ°‘åŒ–é‹å‹•", y:"1937", p:"å°æ—èº‹é€ ", k:"æ”¹å§“å", d:"ä¸­æ—¥æˆ°çˆ­çˆ†ç™¼ï¼Œæ—¥æœ¬ä¼åœ–å°‡å°ç£äººæ”¹é€ æˆæ—¥æœ¬äºº" },
        { s:"æ­·å²", t:["åœ‹ä¹","å°ç£å²"], e:"äºŒäºŒå…«äº‹ä»¶", y:"1947", p:"é™³å„€", k:"æŸ¥ç·ç§è¸", d:"æˆ°å¾ŒåˆæœŸå› æ”¿æ²»è…æ•—èˆ‡æ–‡åŒ–è¡çªå¼•ç™¼çš„åš´é‡æµè¡€äº‹ä»¶" },
        { s:"æ­·å²", t:["åœ‹ä¹","å°ç£å²"], e:"è€•è€…æœ‰å…¶ç”°", y:"1953", p:"é™³èª ", k:"åœŸåœ°æ”¹é©", d:"æ”¿åºœå¾µæ”¶åœ°ä¸»åœŸåœ°æ”¾é ˜çµ¦ä½ƒè¾²ï¼Œä¿ƒé€²è¾²æ¥­ç™¼å±•" },
        { s:"æ­·å²", t:["åœ‹ä¹","å°ç£å²"], e:"ç¾éº—å³¶äº‹ä»¶", y:"1979", p:"æ–½æ˜å¾·", k:"é»¨å¤–é‹å‹•", d:"äººæ¬Šæ—¥éŠè¡Œé­é®å£“ï¼Œå¯©åˆ¤éç¨‹å–šèµ·æ°‘çœ¾æ°‘ä¸»æ„è­˜" },
        { s:"æ­·å²", t:["åœ‹ä¹","å°ç£å²"], e:"è§£åš´", y:"1987", p:"è”£ç¶“åœ‹", k:"é–‹æ”¾é»¨ç¦å ±ç¦", d:"è§£é™¤é•·é”38å¹´çš„æˆ’åš´ï¼Œå°ç£é‚å‘æ°‘ä¸»æ†²æ”¿" },
        { s:"æ­·å²", t:["åœ‹ä¹","å°ç£å²"], e:"é‡ç™¾åˆå­¸é‹", y:"1990", p:"å¤§å­¸ç”Ÿ", k:"å»¢é™¤è¬å¹´åœ‹æœƒ", d:"å°ç£æˆ°å¾Œæœ€å¤§è¦æ¨¡å­¸ç”Ÿé‹å‹•ï¼Œä¿ƒæˆæ†²æ”¿æ”¹é©" },

        // ---------------

            // [æ­·å² - ä¸­åœ‹å²]
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"å•†é…è®Šæ³•", y:"æˆ°åœ‹æ™‚æœŸ", p:"å•†é…", k:"å¯Œåœ‹å¼·å…µ", d:"ç§¦åœ‹å› æ­¤å¼·ç››ï¼Œç‚ºå¾Œä¾†çµ±ä¸€ä¸­åœ‹å¥ å®šåŸºç¤" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"ç§¦å§‹çš‡çµ±ä¸€", y:"è¥¿å…ƒå‰221", p:"å¬´æ”¿", k:"éƒ¡ç¸£åˆ¶", d:"å»¢å°å»ºã€è¡Œéƒ¡ç¸£ï¼Œçµ±ä¸€æ–‡å­—ã€è»Šè»Œã€åº¦é‡è¡¡" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"ç¨å°Šå„’è¡“", y:"æ¼¢æ­¦å¸", p:"è‘£ä»²èˆ’", k:"å¯Ÿèˆ‰åˆ¶", d:"ç½·é»œç™¾å®¶ï¼Œç¢ºç«‹å„’å®¶æ€æƒ³ç‚ºä¸­åœ‹æ­£çµ±æ–‡åŒ–" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"å¼µé¨«é€šè¥¿åŸŸ", y:"æ¼¢æ­¦å¸", p:"å¼µé¨«", k:"çµ²è·¯", d:"åŸæœ¬ç‚ºäº†è¯çµ¡å¤§æœˆæ°å¤¾æ“ŠåŒˆå¥´ï¼Œæ„å¤–é–‹é€šæ±è¥¿è²¿æ˜“" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"èµ¤å£ä¹‹æˆ°", y:"208å¹´", p:"å­«æ¬Š/åŠ‰å‚™", k:"ä¸‰åˆ†å¤©ä¸‹", d:"å­«åŠ‰è¯è»æ“Šæ•—æ›¹æ“ï¼Œå¥ å®šä¸‰åœ‹é¼ç«‹å±€å‹¢" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"æ°¸å˜‰ä¹‹ç¦", y:"311å¹´", p:"åŒˆå¥´", k:"è¡£å† å—æ¸¡", d:"è¥¿æ™‰æ»…äº¡ï¼Œä¸–æ—å—é·ï¼ŒåŒ—æ–¹é€²å…¥äº”èƒ¡åå…­åœ‹" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"å­æ–‡å¸æ¼¢åŒ–", y:"åŒ—é­", p:"æ‹“è·‹å®", k:"æ”¹æ¼¢å§“", d:"é®®å‘æ—æ¼¢åŒ–æ”¿ç­–ï¼Œä¿ƒé€²èƒ¡æ¼¢èåˆ" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"è²è§€ä¹‹æ²»", y:"å”å¤ªå®—", p:"æä¸–æ°‘", k:"å¤©å¯æ±—", d:"å”æœåœ‹åŠ›å¼·ç››ï¼Œå›ä¸»è¢«è¥¿åŒ—å„æ—å°Šç‚ºå…±ä¸»" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"å®‰å²ä¹‹äº‚", y:"755-763", p:"å®‰ç¥¿å±±", k:"è—©é®å‰²æ“š", d:"å”æœç”±ç››è½‰è¡°çš„é—œéµï¼Œå°è‡´åœ°æ–¹ç¯€åº¦ä½¿æ¬ŠåŠ›åå¤§" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"æ¾¶æ·µä¹‹ç›Ÿ", y:"åŒ—å®‹", p:"å®‹çœŸå®—", k:"æ­²å¹£", d:"å®‹é¼ç°½è¨‚å’Œç´„ï¼Œç¶­æŒäº†ç™¾å¹´çš„å’Œå¹³" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"è’™å¤è¥¿å¾", y:"13ä¸–ç´€", p:"æˆå‰æ€æ±—", k:"ç«è—¥è¥¿å‚³", d:"å»ºç«‹è·¨æ­äºå¤§å¸åœ‹ï¼Œä¿ƒé€²æ±è¥¿æ–‡åŒ–äº¤æµ" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"é„­å’Œä¸‹è¥¿æ´‹", y:"æ˜æˆç¥–", p:"é„­å’Œ", k:"æœè²¢è²¿æ˜“", d:"å®£æšåœ‹å¨ï¼Œæœ€é åˆ°é”éæ´²æ±å²¸" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"å¼µå±…æ­£è®Šæ³•", y:"æ˜ç¥å®—", p:"å¼µå±…æ­£", k:"ä¸€æ¢é­æ³•", d:"å°‡è³¦å½¹åˆä½µå¾µéŠ€ï¼Œç°¡åŒ–ç¨…åˆ¶" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"é´‰ç‰‡æˆ°çˆ­", y:"1840", p:"æ—å‰‡å¾", k:"å—äº¬æ¢ç´„", d:"ä¸­åœ‹ç°½è¨‚ç¬¬ä¸€å€‹ä¸å¹³ç­‰æ¢ç´„ï¼Œå‰²è®“é¦™æ¸¯" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"å¤ªå¹³å¤©åœ‹", y:"1851", p:"æ´ªç§€å…¨", k:"å¤©æœç”°ç•", d:"æ¸…æœ«è¦æ¨¡æœ€å¤§çš„æ°‘è®Šï¼Œé‡å‰µæ¸…æœçµ±æ²»æ ¹åŸº" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"è‡ªå¼·é‹å‹•", y:"1860", p:"æé´»ç« ", k:"å¸«å¤·é•·æŠ€", d:"å­¸ç¿’è¥¿æ–¹å™¨ç‰©å±¤é¢ï¼Œæ¨å‹•è»äº‹å·¥æ¥­" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"ç”²åˆæˆ°çˆ­", y:"1894", p:"å…‰ç·’", k:"é¦¬é—œæ¢ç´„", d:"æ¸…æœæˆ°æ•—ï¼Œå‰²è®“å°ç£æ¾æ¹–çµ¦æ—¥æœ¬" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"æˆŠæˆŒè®Šæ³•", y:"1898", p:"åº·æœ‰ç‚º", k:"ç™¾æ—¥ç¶­æ–°", d:"å­¸ç¿’è¥¿æ–¹åˆ¶åº¦å±¤é¢ï¼Œå› æ…ˆç¦§å¤ªåæ”¿è®Šå¤±æ•—" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"è¾›äº¥é©å‘½", y:"1911", p:"å­«ä¸­å±±", k:"æ­¦æ˜Œèµ·ç¾©", d:"æ¨ç¿»æ»¿æ¸…å¸åˆ¶ï¼Œå»ºç«‹äºæ´²ç¬¬ä¸€å€‹æ°‘ä¸»å…±å’Œåœ‹" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"äº”å››é‹å‹•", y:"1919", p:"èƒ¡é©", k:"å¾·å…ˆç”Ÿè³½å…ˆç”Ÿ", d:"æŠ—è­°å·´é»å’Œæœƒå±±æ±å•é¡Œï¼Œæå€¡æ°‘ä¸»èˆ‡ç§‘å­¸" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"åŒ—ä¼çµ±ä¸€", y:"1928", p:"è”£ä¸­æ­£", k:"é»ƒé‡‘åå¹´", d:"åœ‹æ°‘é©å‘½è»çµ±ä¸€ä¸­åœ‹ï¼Œå±•é–‹å»ºè¨­" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"æ–‡åŒ–å¤§é©å‘½", y:"1966-1976", p:"æ¯›æ¾¤æ±", k:"ç´…è¡›å…µ", d:"åå¹´å‹•äº‚ï¼Œç ´å››èˆŠï¼Œå‚³çµ±æ–‡åŒ–é­åš´é‡ç ´å£" },
            { s:"æ­·å²", t:["åœ‹å…«","ä¸­åœ‹å²"], e:"æ”¹é©é–‹æ”¾", y:"1978", p:"é„§å°å¹³", k:"ç¶“æ¿Ÿç‰¹å€", d:"ä¸­åœ‹ç¶“æ¿Ÿé«”åˆ¶æ”¹é©ï¼Œè¨­ç«‹æ·±åœ³ç­‰ç‰¹å€" },

            // [æ­·å² - ä¸–ç•Œå²]
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"æ¼¢æ‘©æ‹‰æ¯”æ³•å…¸", y:"å¤å·´æ¯”å€«", p:"æ¼¢æ‘©æ‹‰æ¯”", k:"ä»¥ç‰™é‚„ç‰™", d:"ä¸–ç•Œä¸Šç¾å­˜æœ€æ—©çš„æˆæ–‡æ³•å…¸ä¹‹ä¸€" },
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"é‡‘å­—å¡”", y:"å¤åŸƒåŠ", p:"æ³•è€", k:"å°¼ç¾…æ²³", d:"åŸƒåŠäººç›¸ä¿¡ä¾†ä¸–ï¼Œè£½ä½œæœ¨ä¹ƒä¼Šèˆ‡å·¨å¤§é™µå¢“" },
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"ç¨®å§“åˆ¶åº¦", y:"å¤å°åº¦", p:"é˜¿åˆ©å®‰äºº", k:"å©†ç¾…é–€", d:"å°‡äººåˆ†ç‚ºå››å€‹éšç´šï¼Œéšç´šæ£®åš´ä¸–è¥²" },
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"é›…å…¸æ°‘ä¸»", y:"å¤å¸Œè‡˜", p:"ä¼¯é‡Œå…‹åˆ©", k:"é™¶ç‰‡æµæ”¾", d:"æˆå¹´ç”·æ€§å…¬æ°‘å¯åƒèˆ‡å…¬æ°‘å¤§æœƒï¼Œå¯¦è¡Œç›´æ¥æ°‘ä¸»" },
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"äºæ­·å±±å¤§æ±å¾", y:"å¸Œè‡˜åŒ–æ™‚ä»£", p:"äºæ­·å±±å¤§", k:"æ±è¥¿èåˆ", d:"èåˆå¸Œè‡˜ã€è¥¿äºã€åŸƒåŠæ–‡åŒ–ï¼Œç§‘å­¸è—è¡“ç™¼é”" },
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"ç¾…é¦¬å’Œå¹³", y:"ç¾…é¦¬å¸åœ‹", p:"å±‹å¤§ç¶­", k:"æ¢æ¢å¤§è·¯é€šç¾…é¦¬", d:"å¸åœ‹åˆæœŸå…©ç™¾å¹´çš„å¼·ç››èˆ‡å’Œå¹³æ™‚æœŸ" },
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"åå­—è»æ±å¾", y:"11-13ä¸–ç´€", p:"æ•™å®—", k:"æ”¶å¾©è–åœ°", d:"é›–è»äº‹å¤±æ•—ï¼Œä½†ä¿ƒé€²äº†æ±è¥¿æ–¹è²¿æ˜“èˆ‡æ–‡åŒ–äº¤æµ" },
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"é»‘æ­»ç—…", y:"14ä¸–ç´€", p:"é¼ ç–«", k:"äººå£éŠ³æ¸›", d:"é€ æˆæ­æ´²ä¸‰åˆ†ä¹‹ä¸€äººå£æ­»äº¡ï¼Œå°å»ºåˆ¶åº¦å‹•æ–" },
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"æ–‡è—å¾©èˆˆ", y:"14-16ä¸–ç´€", p:"é”æ–‡è¥¿", k:"äººæ–‡ä¸»ç¾©", d:"ä»¥äººç‚ºæœ¬ï¼Œé‡æ–°é‡è¦–å¸Œè‡˜ç¾…é¦¬å¤å…¸æ–‡åŒ–" },
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"å®—æ•™æ”¹é©", y:"1517", p:"é¦¬ä¸è·¯å¾·", k:"å› ä¿¡ç¨±ç¾©", d:"åå°è´–ç½ªåˆ¸èˆ‡æ•™æœƒè…æ•—ï¼Œä¿ƒæˆæ–°æ•™ç”¢ç”Ÿ" },
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"åœ°ç†å¤§ç™¼ç¾", y:"15ä¸–ç´€æœ«", p:"å“¥å€«å¸ƒ", k:"æ–°èˆªè·¯", d:"ç™¼ç¾æ–°å¤§é™¸ï¼Œå…¨çƒè²¿æ˜“ç¶²é–‹å§‹å½¢æˆ" },
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"ç§‘å­¸é©å‘½", y:"17ä¸–ç´€", p:"ç‰›é “", k:"è¬æœ‰å¼•åŠ›", d:"å¼·èª¿è§€å¯Ÿèˆ‡å¯¦é©—ï¼Œå»ºç«‹è¿‘ä»£ç§‘å­¸åŸºç¤" },
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"å•Ÿè’™é‹å‹•", y:"18ä¸–ç´€", p:"ä¼çˆ¾æ³°", k:"ç†æ€§", d:"å¼·èª¿ç†æ€§èˆ‡å¤©è³¦äººæ¬Šï¼Œå½±éŸ¿ç¾åœ‹èˆ‡æ³•åœ‹é©å‘½" },
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"å·¥æ¥­é©å‘½", y:"18ä¸–ç´€ä¸­", p:"ç“¦ç‰¹", k:"è’¸æ±½æ©Ÿ", d:"ç”Ÿç”¢æ–¹å¼ç”±æ‰‹å·¥è½‰ç‚ºæ©Ÿæ¢°ï¼Œå·¥å» åˆ¶åº¦èˆˆèµ·" },
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"ç¾åœ‹ç¨ç«‹", y:"1776", p:"è¯ç››é “", k:"ç¨ç«‹å®£è¨€", d:"è„«é›¢è‹±åœ‹æ®–æ°‘ï¼Œå»ºç«‹ä¸‰æ¬Šåˆ†ç«‹çš„æ°‘ä¸»åœ‹å®¶" },
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"æ³•åœ‹å¤§é©å‘½", y:"1789", p:"è·¯æ˜“åå…­", k:"äººæ¬Šå®£è¨€", d:"æ¨ç¿»å°ˆåˆ¶ç‹æ¬Šï¼Œè¿½æ±‚è‡ªç”±å¹³ç­‰åšæ„›" },
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"ç¬¬ä¸€æ¬¡ä¸–ç•Œå¤§æˆ°", y:"1914-1918", p:"å¨å»‰äºŒä¸–", k:"å£•æºæˆ°", d:"å¥§åŒˆå¸åœ‹çš‡å„²è¢«åˆºå¼•çˆ†ï¼ŒåŒç›Ÿåœ‹èˆ‡å”ç´„åœ‹å°æŠ—" },
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"ç¶“æ¿Ÿå¤§ææ…Œ", y:"1929", p:"ç¾…æ–¯ç¦", k:"æ–°æ”¿", d:"è¯çˆ¾è¡—è‚¡å¸‚å´©ç›¤å¼•ç™¼å…¨çƒç¶“æ¿Ÿè¡°é€€" },
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ°", y:"1939-1945", p:"å¸Œç‰¹å‹’", k:"è»¸å¿ƒåœ‹", d:"å¾·åœ‹å…¥ä¾µæ³¢è˜­å¼•çˆ†ï¼Œäººé¡å²ä¸Šæœ€å¤§è¦æ¨¡æˆ°çˆ­" },
            { s:"æ­·å²", t:["åœ‹ä¹","ä¸–ç•Œå²"], e:"å†·æˆ°", y:"1947-1991", p:"ç¾è˜‡", k:"éµå¹•", d:"è³‡æœ¬ä¸»ç¾©èˆ‡å…±ç”¢ä¸»ç¾©å…©å¤§é™£ç‡Ÿçš„å°æŠ—" },
        ];

        // ... (askTemplates and generateHistoryOptions_Safe remain same) ...
        const askTemplates = [
            item => `å˜¿ï½ä¾†çœ‹çœ‹ã€Œ${item.e}ã€å§ï¼å®ƒæœ€ç›¸é—œçš„æ˜¯å“ªä¸€å€‹å¹´ä»£æˆ–ç‰¹è‰²å‘¢ï¼Ÿ`,
            item => `å¦‚æœæåˆ°ã€Œ${item.e}ã€ï¼Œä½ æœƒæƒ³åˆ°å“ªå€‹äº‹ä»¶èƒŒæ™¯ï¼Ÿä»¥ä¸‹å“ªå€‹æœ€æ­£ç¢ºï¼Ÿ`,
            item => `åœ¨æ­·å²èª²å‡ºç¾çš„ã€Œ${item.e}ã€ï¼Œå…¶é‡é»ç‰¹è‰²æ˜¯ä»€éº¼ï¼Ÿé¸ä¸€å€‹æœ€è²¼è¿‘çš„ï¼`,
            item => `æƒ³åƒä½ åœ¨è€ƒå¤ç¾å ´æŒ–åˆ°ã€Œ${item.e}ã€çš„ç·šç´¢ï½ä½ è¦ºå¾—å®ƒç¬¦åˆå“ªæ®µæ™‚æœŸï¼Ÿ`,
            item => `è€å¸«çªç„¶å•ï¼šã€Œ${item.e}ã€æœ€é—œéµçš„å¹´ä»£/ç‰¹è‰²ï¼Ÿä½ æœƒé¸ï¼Ÿ`,
            item => `ä¸‹åˆ—å“ªä¸€å€‹ï¼Œæ˜¯ã€Œ${item.e}ã€æœ€å…·ä»£è¡¨æ€§çš„é—œéµï¼Ÿ`,
            item => `å¦‚æœæŠŠã€Œ${item.e}ã€æ‹æˆé›»å½±ï¼Œä½ è¦ºå¾—èƒŒæ™¯æœƒæ˜¯å“ªæ®µæ™‚æœŸï¼Ÿ`,
            item => `ä»¥ä¸‹å“ªä¸€é …ï¼Œæœ€èƒ½èªªæ˜ã€Œ${item.e}ã€çš„é‡è¦æ„ç¾©ï¼Ÿ`,
            item => `ã€Œ${item.e}ã€åœ¨æ­·å²ä¸Šå¾ˆé‡è¦ï½å®ƒåˆ°åº•æ˜¯å“ªæ®µæ™‚é–“çš„äº‹å‘¢ï¼Ÿ`,
            item => `é¸ä¸€å€‹æœ€ç¬¦åˆã€Œ${item.e}ã€æè¿°çš„å¹´ä»£/ç‰¹è‰²å§ï¼`
        ];

        function generateHistoryOptions_Safe(G, db, item, field) {
            const { shuffle } = G.utils;
            const correctAns = item[field].trim();
            const selected = new Set();
            selected.add(correctAns);
            const wrongOpts = [];
            const sameTag = shuffle(db.filter(x => x.t[1] === item.t[1]));
            for (const cand of sameTag) {
                const txt = cand[field].trim();
                if (!selected.has(txt)) { wrongOpts.push(txt); selected.add(txt); }
                if (wrongOpts.length >= 3) break;
            }
            if (wrongOpts.length < 3) {
                const all = shuffle(db);
                for (const cand of all) {
                    const txt = cand[field].trim();
                    if (!selected.has(txt)) { wrongOpts.push(txt); selected.add(txt); }
                    if (wrongOpts.length >= 3) break;
                }
            }
            const finalOpts = shuffle([correctAns, ...wrongOpts]);
            return { options: finalOpts, answer: finalOpts.indexOf(correctAns) };
        }

        // ----------------------------------------------
        // ğŸ¯ è¨»å†Šï¼šæ­·å²æ´»æ½‘ç‰ˆé¡Œç›® (with Image Triggers)
        // ----------------------------------------------
        G.registerTemplate('his_feat', (ctx, rnd) => {
            const item = pick(historyDB);
            const { options, answer } = generateHistoryOptions_Safe(G, historyDB, item, 'y');
            
            // Logic to determine a relevant image query
            let imageTag = "";
            if (item.t[1] === "å°ç£å²") {
                 imageTag = ``;
            } else if (item.t[1] === "ä¸­åœ‹å²") {
                 imageTag = ``;
            } else {
                 imageTag = ``;
            }

            return {
                question: pick(askTemplates)(item),
                options: options,
                answer: answer,
                concept: item.t[1],
                explanation: [
                    `ã€${item.e}ã€‘`,
                    `ğŸ“Œ æ™‚ä»£ï¼š${item.y}`,
                    `ğŸ“Œ é—œéµè©ï¼š${item.k}`,
                    `ğŸ“Œ è§£èªªï¼š${item.d}`,
                    imageTag // Injecting the image tag here for educational reinforcement
                ]
            };
        }, ["history", "æ­·å²", "ç¤¾æœƒ", "åœ‹ä¸ƒ", "åœ‹å…«", "åœ‹ä¹"]);

        console.log("ğŸŒŸ æ­·å²é¡Œåº«ï¼ˆæ´»æ½‘ + åš´æ ¼å»é‡ + åœ–è§£ç‰ˆï¼‰å·²è¼‰å…¥ï¼");
    }
    init();
})(window);

(function(global){
    'use strict';

    function init() {
        const G = global.RigorousGenerator || (window.global && window.global.RigorousGenerator);
        if (!G || !G.registerTemplate) { setTimeout(init, 100); return; }
        
        const { randInt, shuffle, generateNumericOptions } = G.utils;

        // 物理核心題庫
        const phyDB = [
    // 原始 13 筆
    { t: "密度測量", q: (m,v)=>`某金屬塊質量 ${m*10} g，體積 ${v} cm³，其密度為何？`, a: (m,v)=>parseFloat((m*10/v).toFixed(1)), u: "g/cm³", tag:["國八","測量"] },
    { t: "波動學", q: (f,l)=>`一週期波的頻率為 ${f} Hz，波長為 ${l} m，試求其波速。`, a: (f,l)=>f*l, u: "m/s", tag:["國八","波動"] },
    { t: "熱學", q: (m,t)=>`質量 ${m} kg 的水，溫度上升 ${t}°C，吸收熱量多少？(水比熱 1 kcal/kg°C)`, a: (m,t)=>m*t, u: "kcal", tag:["國八","熱學"] },

    { t: "運動學", q: (v,t)=>`一車以速度 ${v} m/s 等速行駛 ${t} 秒，請問位移為多少？`, a: (v,t)=>v*t, u: "m", tag:["國九","運動"] },
    { t: "牛頓第二定律", q: (m,a)=>`質量 ${m} kg 的物體，受力產生 ${a} m/s² 的加速度，請問合力大小？`, a: (m,a)=>m*a, u: "N", tag:["國九","力學"] },
    { t: "功與能量", q: (f,d)=>`施水平力 ${f} N 推動木塊移動 ${d} m，請問作功多少？`, a: (f,d)=>f*d, u: "J", tag:["國九","能量"] },
    { t: "歐姆定律", q: (i,r)=>`一電阻器電阻為 ${r} Ω，通過電流為 ${i} A，兩端電壓為何？`, a: (i,r)=>i*r, u: "V", tag:["國九","電學"] },

    { t: "動能", q: (m,v)=>`質量 ${m} kg 的物體以 ${v} m/s 速率運動，其動能為何？

[Image of kinetic energy formula]
`, a: (m,v)=>0.5*m*v*v, u: "J", tag:["高一","能量"] },
    { t: "重力位能", q: (m,h)=>`質量 ${m} kg 的物體抬高 ${h} m (g=10)，其重力位能增加多少？`, a: (m,h)=>m*10*h, u: "J", tag:["高一","能量"] },
    { t: "自由落體", q: (t,g)=>`物體由靜止自由落下 ${t} 秒 (g=10)，落下距離約為多少？

[Image of free fall diagram]
`, a: (t,g)=>0.5*10*t*t, u: "m", tag:["高二","運動學"] },
    { t: "萬有引力", q: (m,g)=>`質量 ${m} kg 的太空人，在重力加速度 g=2 m/s² 的星球表面，重量為何？`, a: (m,g)=>m*2, u: "N", tag:["高二","引力"] },
    { t: "氣體動力論", q: (p,t)=>`定容下，若氣體絕對溫度由 ${t}K 變為 ${t*2}K，原壓力為 ${p} atm，新壓力為何？`, a: (p,t)=>p*2, u: "atm", tag:["高三","熱學"] },
    { t: "光學", q: (n,v)=>`光在折射率 n=${n} 的介質中傳播，若真空光速 c=3×10⁸ m/s，該介質中光速約為多少？(×10⁸)`, a: (n,v)=>parseFloat((3/n).toFixed(2)), u: "m/s", tag:["高三","光學"] },

    // 新增 87 筆（合計 100 筆）
    { t: "壓力計算", q: (F,A)=>`受力 ${F} N 作用在面積 ${A} m² 上，壓力為何？`, a: (F,A)=>F/A, u: "Pa", tag:["國八","力學"] },
    { t: "浮力", q: (rho,V)=>`物體排開流體體積 ${V} m³，流體密度 ${rho} kg/m³，浮力為何？`, a: (rho,V)=>rho*V*9.8, u: "N", tag:["國九","流體"] },
    { t: "柏努利方程", q: (p1,v1,p2)=>`流速由 ${v1} m/s 增加使壓力由 ${p1} Pa 變為何？(忽略高度差)`, a: (p1,v1,p2)=>p1+0.5*1.0*(v1*v1)-0.5*1.0*(p2||0), u: "Pa", tag:["高二","流體"] },
    { t: "胡克定律", q: (k,x)=>`彈簧常數 ${k} N/m 被拉長 ${x} m，彈力為何？`, a: (k,x)=>-k*x, u: "N", tag:["國九","力學"] },
    { t: "簡諧運動", q: (k,m)=>`質量 ${m} kg 的物體與彈簧常數 ${k} N/m，週期為何？`, a: (k,m)=>2*Math.PI*Math.sqrt(m/k), u: "s", tag:["高一","振動"] },
    { t: "單擺週期", q: (L)=>`長度 ${L} m 的單擺小振幅近似週期為何？(g=9.8)`, a: (L)=>2*Math.PI*Math.sqrt(L/9.8), u: "s", tag:["高一","振動"] },
    { t: "向心力", q: (m,v,r)=>`質量 ${m} kg 以速率 ${v} m/s 做半徑 ${r} m 的圓周運動，向心力為何？`, a: (m,v,r)=>m*v*v/r, u: "N", tag:["國九","力學"] },
    { t: "角速度", q: (v,r)=>`線速度 ${v} m/s，半徑 ${r} m，角速度為何？`, a: (v,r)=>v/r, u: "rad/s", tag:["國九","運動"] },
    { t: "動量守恆（彈性碰撞）", q: (m1,v1,m2,v2)=>`質量 ${m1} kg 速度 ${v1} m/s 與 ${m2} kg 速度 ${v2} m/s 彈性碰撞後，總動量為何？`, a: (m1,v1,m2,v2)=>m1*v1+m2*v2, u: "kg·m/s", tag:["高二","力學"] },
    { t: "衝量", q: (F,dt)=>`力 ${F} N 作用 ${dt} s，衝量為何？`, a: (F,dt)=>F*dt, u: "N·s", tag:["國九","力學"] },

    { t: "功率", q: (W,t)=>`做功 ${W} J 用時 ${t} s，平均功率為何？`, a: (W,t)=>W/t, u: "W", tag:["國九","能量"] },
    { t: "機械效率", q: (Wout,Win)=>`輸出功 ${Wout} J，輸入功 ${Win} J，效率為何？(%)`, a: (Wout,Win)=>parseFloat(((Wout/Win)*100).toFixed(1)), u: "%", tag:["高一","能量"] },
    { t: "熱容量", q: (m,c,dt)=>`質量 ${m} kg 比熱 ${c} kJ/kg°C 溫度變化 ${dt}°C，吸收熱量為何？`, a: (m,c,dt)=>m*c*dt, u: "kJ", tag:["高一","熱學"] },
    { t: "潛熱", q: (m,L)=>`質量 ${m} kg 的物質，潛熱為 ${L} kJ/kg，所需熱量為何？`, a: (m,L)=>m*L, u: "kJ", tag:["高二","熱學"] },
    { t: "理想氣體狀態方程", q: (n,T)=>`在定容下，溫度由 ${T} K 變為 ${T*2} K，壓力變化為何？(p ∝ T)`, a: (n,T)=>2, u: "倍數", tag:["高三","熱學"] },

    { t: "歐姆串聯電阻", q: (R1,R2,I)=>`串聯電阻 ${R1} Ω 與 ${R2} Ω，電流 ${I} A，總電壓為何？`, a: (R1,R2,I)=>I*(R1+R2), u: "V", tag:["國九","電學"] },
    { t: "歐姆並聯電阻", q: (R1,R2,V)=>`並聯兩電阻 ${R1} Ω 與 ${R2} Ω，兩端電壓 ${V} V，總電流為何？`, a: (R1,R2,V)=>V/R1+V/R2, u: "A", tag:["高一","電學"] },
    { t: "電功率", q: (V,I)=>`電壓 ${V} V，電流 ${I} A，電功率為何？`, a: (V,I)=>V*I, u: "W", tag:["國九","電學"] },
    { t: "電荷守恆", q: (q1,q2)=>`系統中電荷 ${q1} C 與 ${q2} C，總電荷為何？`, a: (q1,q2)=>q1+q2, u: "C", tag:["高二","電磁"] },
    { t: "庫侖定律", q: (q1,q2,r)=>`兩電荷 ${q1} C 與 ${q2} C，相距 ${r} m，庫侖力大小為何？(k=9e9)`, a: (q1,q2,r)=>9e9*Math.abs(q1*q2)/(r*r), u: "N", tag:["高二","電磁"] },

    { t: "電場強度", q: (F,q)=>`力 ${F} N 作用於電荷 ${q} C，電場強度為何？`, a: (F,q)=>F/q, u: "N/C", tag:["高二","電磁"] },
    { t: "電位差", q: (W,q)=>`將電荷 ${q} C 移動所做功為 ${W} J，電位差為何？`, a: (W,q)=>W/q, u: "V", tag:["高二","電磁"] },
    { t: "電容充電（RC）", q: (V,R,C,t)=>`RC 電路中時間常數 τ=R·C，若 R=${R} Ω C=${C} F，τ 為何？`, a: (V,R,C,t)=>R*C, u: "s", tag:["高三","電路"] },
    { t: "電磁感應", q: (dPhi,dt)=>`磁通量變化率 dΦ/dt=${dPhi}/${dt} Wb/s，感應電動勢為何？`, a: (dPhi,dt)=>-dPhi/dt, u: "V", tag:["高三","電磁"] },

    { t: "磁力（洛倫茲）", q: (q,v,B)=>`電荷 ${q} C 以速度 ${v} m/s 垂直穿過磁場 B=${B} T，受磁力為何？`, a: (q,v,B)=>q*v*B, u: "N", tag:["高三","電磁"] },
    { t: "電磁波速", q: (f,)=>`頻率 ${f} Hz 的電磁波在真空中波長為何？(c=3e8)`, a: (f)=>3e8/f, u: "m", tag:["高三","波動"] },
    { t: "多普勒效應（聲波）", q: (v_s,v_o,f)=>`觀測者速度 ${v_o} m/s，波源速度 ${v_s} m/s，頻率 ${f} Hz，近似多普勒頻率為何？(空氣中 c=340 m/s)`, a: (v_s,v_o,f)=>f*(340+v_o)/(340-v_s), u: "Hz", tag:["高三","波動"] },
    { t: "聲強與分貝", q: (I)=>`聲強度 ${I} W/m²，聲壓級 (dB) 為何？(I0=1e-12)`, a: (I)=>10*Math.log10(I/1e-12), u: "dB", tag:["高二","波動"] },

    { t: "弦波駐波（開端）", q: (L,n,v)=>`弦長 ${L} m，基頻為第 ${n} 次諧波，波速 ${v} m/s，頻率為何？`, a: (L,n,v)=>n*v/(2*L), u: "Hz", tag:["高一","波動"] },
    { t: "管內駐波（開口）", q: (L,n,v)=>`開口管長 ${L} m，第 ${n} 次諧波頻率為何？(n=1,2,3...)`, a: (L,n,v)=>n*v/(2*L), u: "Hz", tag:["高二","波動"] },
    { t: "光的折射（斯涅爾）", q: (n1,n2,theta1)=>`入射角 ${theta1}°，折射率 n1=${n1}, n2=${n2}，折射角為何？`, a: (n1,n2,theta1)=>Math.asin((n1/n2)*Math.sin(theta1*Math.PI/180))*180/Math.PI, u: "deg", tag:["高一","光學"] },
    { t: "薄透鏡成像（薄透鏡公式）", q: (f,do)=>`焦距 ${f} m，物距 ${do} m，求像距？(1/f=1/do+1/di)`, a: (f,do)=>1/(1/f-1/do), u: "m", tag:["高二","光學"] },

    { t: "放大率", q: (di,do)=>`像距 ${di} m，物距 ${do} m，線性放大率為何？`, a: (di,do)=>-di/do, u: "倍", tag:["高二","光學"] },
    { t: "衍射格柵", q: (d,m,lambda)=>`格柵間距 ${d} m，衍射級數 m=${m}，波長 ${lambda} m，角度為何？`, a: (d,m,lambda)=>Math.asin(m*lambda/d), u: "rad", tag:["高三","光學"] },
    { t: "光電效應（光子能量）", q: (lambda,)=>`波長 ${lambda} m 的光子能量為何？(h=6.626e-34)`, a: (lambda)=>6.626e-34*3e8/lambda, u: "J", tag:["高三","量子"] },
    { t: "普朗克能量量子化", q: (f)=>`頻率 ${f} Hz 的光子能量為何？`, a: (f)=>6.626e-34*f, u: "J", tag:["高三","量子"] },

    { t: "德布羅意波長", q: (m,v)=>`質量 ${m} kg 速度 ${v} m/s 的粒子德布羅意波長為何？(h=6.626e-34)`, a: (m,v)=>6.626e-34/(m*v), u: "m", tag:["高三","量子"] },
    { t: "核衰變（半衰期）", q: (N0,t,half)=>`初始數量 ${N0}，經過 ${t} s，半衰期 ${half} s，剩餘數量為何？`, a: (N0,t,half)=>N0*Math.pow(0.5,t/half), u: "個體", tag:["高三","核物理"] },
    { t: "質能等價", q: (m)=>`質量 ${m} kg 對應能量 E=mc²，c=3e8，E 為何？`, a: (m)=>m*9e16, u: "J", tag:["高三","核物理"] },
    { t: "放射性活度", q: (lambda,N)=>`衰變常數 ${lambda} s⁻¹，核子數 N，活度 A 為何？`, a: (lambda,N)=>lambda*N, u: "Bq", tag:["高三","核物理"] },

    { t: "熱傳導（傅里葉）", q: (k,A,dT,dx)=>`熱導率 ${k} W/m·K，面積 ${A} m²，溫差 ${dT} K，厚度 ${dx} m，熱流率為何？`, a: (k,A,dT,dx)=>k*A*dT/dx, u: "W", tag:["高二","熱學"] },
    { t: "對流熱傳", q: (h,A,dT)=>`對流係數 ${h} W/m²K，面積 ${A} m²，溫差 ${dT} K，熱流率為何？`, a: (h,A,dT)=>h*A*dT, u: "W", tag:["高二","熱學"] },
    { t: "斯特藩-玻爾茲曼定律", q: (A,T)=>`面積 ${A} m²，溫度 ${T} K，黑體輻射功率為何？(σ=5.67e-8)`, a: (A,T)=>5.67e-8*A*Math.pow(T,4), u: "W", tag:["高三","熱學"] },
    { t: "比熱測定（混合法）", q: (m1,T1,m2,T2)=>`質量 ${m1} kg 溫度 ${T1}°C 與 ${m2} kg 溫度 ${T2}°C 混合，平衡溫度為何？(忽略容器熱量)`, a: (m1,T1,m2,T2)=>(m1*T1+m2*T2)/(m1+m2), u: "°C", tag:["高二","熱學"] },

    { t: "黏滯力（斯托克斯）", q: (r,v,eta)=>`球半徑 ${r} m，速度 ${v} m/s，黏滯係數 ${eta} Pa·s，阻力為何？`, a: (r,v,eta)=>6*Math.PI*eta*r*v, u: "N", tag:["高三","流體"] },
    { t: "雷諾數", q: (rho,v,L,mu)=>`流體密度 ${rho} kg/m³，速度 ${v} m/s，特徵長度 ${L} m，黏性係數 ${mu} Pa·s，雷諾數為何？`, a: (rho,v,L,mu)=>rho*v*L/mu, u: "無量綱", tag:["高二","流體"] },
    { t: "伯努利應用（飛機升力）", q: (rho,v1,v2)=>`流速差 v1=${v1} m/s 與 v2=${v2} m/s，升力壓力差為何？`, a: (rho,v1,v2)=>0.5*rho*(v2*v2-v1*v1), u: "Pa", tag:["高三","流體"] },
    { t: "表面張力", q: (gamma,L)=>`表面張力係數 ${gamma} N/m，邊長 ${L} m，力為何？`, a: (gamma,L)=>gamma*L, u: "N", tag:["高二","流體"] },

    { t: "毛細現象高度", q: (gamma,rho,g,theta,r)=>`表面張力 ${gamma}，流體密度 ${rho}，接觸角 ${theta}，毛細管半徑 ${r}，毛細上升高度為何？`, a: (gamma,rho,g,theta,r)=> (2*gamma*Math.cos(theta))/(rho*g*r), u: "m", tag:["高三","流體"] },
    { t: "楊氏模數（應力應變）", q: (F,A,dx,L)=>`受力 ${F} N，面積 ${A} m²，伸長 ${dx} m，原長 ${L} m，楊氏模數為何？`, a: (F,A,dx,L)=> (F/A)/(dx/L), u: "Pa", tag:["高三","材料"] },
    { t: "應變能（彈性位能）", q: (k,x)=>`彈簧常數 ${k} N/m，伸長 ${x} m，彈性位能為何？`, a: (k,x)=>0.5*k*x*x, u: "J", tag:["高二","力學"] },
    { t: "斷裂應力估算", q: (sigma_y,area)=>`材料屈服強度 ${sigma_y} Pa，截面面積 ${area} m²，最大承載力為何？`, a: (sigma_y,area)=>sigma_y*area, u: "N", tag:["高三","材料"] },

    { t: "聲速（氣體）", q: (T)=>`氣體溫度 ${T} K，近似聲速為何？(v≈331+0.6·(T-273))`, a: (T)=>331+0.6*(T-273), u: "m/s", tag:["高二","波動"] },
    { t: "聲音強度距離衰減", q: (I0,r0,r)=>`原始距離 ${r0} m 強度 ${I0} W/m²，距離 r=${r} m 時強度為何？(點源)`, a: (I0,r0,r)=>I0*(r0*r0)/(r*r), u: "W/m²", tag:["高二","波動"] },
    { t: "拍頻", q: (f1,f2)=>`兩頻率 ${f1} Hz 與 ${f2} Hz，拍頻為何？`, a: (f1,f2)=>Math.abs(f1-f2), u: "Hz", tag:["高一","波動"] },
    { t: "聲壓級相加（近似）", q: (L1,L2)=>`兩聲壓級 L1=${L1} dB 與 L2=${L2} dB，合成近似為何？`, a: (L1,L2)=>10*Math.log10(Math.pow(10,L1/10)+Math.pow(10,L2/10)), u: "dB", tag:["高二","波動"] },

    { t: "熱機效率（卡諾）", q: (Th,Tc)=>`熱庫溫度 Th=${Th} K，冷庫 Tc=${Tc} K，卡諾效率為何？`, a: (Th,Tc)=>1-Tc/Th, u: "無量綱", tag:["高三","熱力學"] },
    { t: "理想氣體摩爾數", q: (p,V,T)=>`壓力 ${p} Pa，體積 ${V} m³，溫度 ${T} K，摩爾數 n 為何？(R=8.314)`, a: (p,V,T)=>p*V/8.314/T, u: "mol", tag:["高三","熱學"] },
    { t: "氣體分子速率（平均）", q: (T,M)=>`溫度 ${T} K，分子量 ${M} kg/mol，平均速率近似為何？(簡化)`, a: (T,M)=>Math.sqrt(8*8.314*T/(Math.PI*M)), u: "m/s", tag:["高三","熱學"] },
    { t: "布朗運動趨勢", q: (T,eta,r)=>`溫度 ${T} K，黏滯係數 ${eta} Pa·s，粒子半徑 ${r} m，擴散趨勢與哪些參數相關？`, a: (T,eta,r)=>`與 T 成正比，與 eta 與 r 成反比`, u: "描述", tag:["高三","統計物理"] },

    { t: "電磁波能量密度", q: (E,B)=>`電場強度 ${E} V/m 磁場強度 ${B} T，能量密度為何？`, a: (E,B)=>0.5*(Math.pow(E,2)/ (3e8*3e8*8.854e-12) + Math.pow(B,2)/ (1/(4*Math.PI*1e-7))), u: "J/m³", tag:["高三","電磁"] },
    { t: "電阻溫度係數", q: (R0,alpha,dt)=>`初始電阻 ${R0} Ω，溫度係數 ${alpha} /°C，溫差 ${dt}°C，電阻為何？`, a: (R0,alpha,dt)=>R0*(1+alpha*dt), u: "Ω", tag:["高二","電學"] },
    { t: "半導體二極體電流（近似）", q: (Is,V,n,T)=>`反向飽和電流 Is=${Is} A，電壓 V=${V} V，指數因子 n=${n}，電流近似為何？(I=Is(e^{qV/nkT}-1))`, a: (Is,V,n,T)=>Is*(Math.exp(1.6e-19*V/(1.38e-23*n*T))-1), u: "A", tag:["高三","半導體"] },
    { t: "太陽能電池輸出功率", q: (I,V)=>`電流 ${I} A 電壓 ${V} V，輸出功率為何？`, a: (I,V)=>I*V, u: "W", tag:["高三","能源"] },

    { t: "熱膨脹長度變化", q: (L0,alpha,dT)=>`原長 ${L0} m 線膨脹係數 ${alpha} /°C 溫差 ${dT}°C，長度變化為何？`, a: (L0,alpha,dT)=>L0*alpha*dT, u: "m", tag:["高二","材料"] },
    { t: "楊氏模數應用（梁撓度）", q: (F,L,E,I)=>`簡支梁中間受力 F，長度 L，楊氏模數 E，慣性矩 I，最大撓度近似為何？`, a: (F,L,E,I)=> (F*Math.pow(L,3))/(48*E*I), u: "m", tag:["高三","材料"] },
    { t: "彈性碰撞速度（一維）", q: (m1,u1,m2,u2)=>`一維彈性碰撞後速度為何？`, a: (m1,u1,m2,u2)=>{ let v1=( (m1-m2)*u1 + 2*m2*u2 )/(m1+m2); let v2=( 2*m1*u1 + (m2-m1)*u2 )/(m1+m2); return {v1:v1,v2:v2}; }, u: "m/s", tag:["高二","力學"] },
    { t: "非彈性碰撞動能損失", q: (m1,u1,m2,u2)=>`完全非彈性碰撞合併後動能損失為何？`, a: (m1,u1,m2,u2)=>{ let v=(m1*u1+m2*u2)/(m1+m2); let KE_before=0.5*m1*u1*u1+0.5*m2*u2*u2; let KE_after=0.5*(m1+m2)*v*v; return KE_before-KE_after; }, u: "J", tag:["高二","力學"] },

    { t: "電容串聯等效", q: (C1,C2)=>`串聯電容 C1=${C1} F 與 C2=${C2} F，等效電容為何？`, a: (C1,C2)=>1/(1/C1+1/C2), u: "F", tag:["高三","電路"] },
    { t: "電容並聯等效", q: (C1,C2)=>`並聯電容 C1=${C1} F 與 C2=${C2} F，等效電容為何？`, a: (C1,C2)=>C1+C2, u: "F", tag:["高三","電路"] },
    { t: "LC 共振頻率", q: (L,C)=>`電感 L=${L} H 電容 C=${C} F，諧振頻率為何？`, a: (L,C)=>1/(2*Math.PI*Math.sqrt(L*C)), u: "Hz", tag:["高三","電路"] },
    { t: "交流有效值", q: (Vpeak)=>`正弦波峰值 ${Vpeak} V，有效值為何？`, a: (Vpeak)=>Vpeak/Math.sqrt(2), u: "V", tag:["高三","電學"] },

    { t: "磁通量", q: (B,A,theta)=>`磁場 B=${B} T 穿過面積 A=${A} m²，夾角 ${theta}°，磁通量為何？`, a: (B,A,theta)=>B*A*Math.cos(theta*Math.PI/180), u: "Wb", tag:["高三","電磁"] },
    { t: "法拉第感應電動勢（線圈）", q: (N,dPhi,dt)=>`線圈匝數 N=${N}，磁通變化 dΦ=${dPhi} Wb，時間 dt=${dt} s，感應電動勢為何？`, a: (N,dPhi,dt)=>-N*(dPhi/dt), u: "V", tag:["高三","電磁"] },
    { t: "電磁波頻譜分類", q: (lambda)=>`波長 ${lambda} m 屬於哪類電磁波？`, a: (lambda)=> lambda>1e-1?"無線電/微波或更長波段":(lambda>7e-7?"紅外/可見/近紅外":"紫外/X射線/伽瑪"), u: "分類", tag:["高三","波動"] },
    { t: "光的偏振", q: ()->`偏振光的特性為何？`, a: ()=>`電場方向有規則性，透過偏振片可選擇方向`, u: "描述", tag:["高二","光學"] },

    { t: "熱力學第一定律（簡述）", q: ()->`熱力學第一定律內容為何？`, a: ()=>`ΔU=Q−W，能量守恆`, u: "描述", tag:["高三","熱力學"] },
    { t: "熱力學第二定律（卡諾）", q: ()->`熱力學第二定律要點為何？`, a: ()=>`不可逆過程與熵增加，卡諾效率為上限`, u: "描述", tag:["高三","熱力學"] },
    { t: "熵變化（等溫）", q: (Q,T)=>`等溫過程中吸收熱量 Q=${Q} J，溫度 T=${T} K，熵變為何？`, a: (Q,T)=>Q/T, u: "J/K", tag:["高三","熱力學"] },
    { t: "理想氣體比熱比 γ", q: (Cp,Cv)=>`定壓比熱 Cp=${Cp} 定容比熱 Cv=${Cv}，比熱比 γ 為何？`, a: (Cp,Cv)=>Cp/Cv, u: "無量綱", tag:["高三","熱學"] },

    { t: "光纖折射率差", q: (n_core,n_clad)=>`核心折射率 ${n_core} 包層 ${n_clad}，數值孔徑 NA 為何？`, a: (n_core,n_clad)=>Math.sqrt(n_core*n_core-n_clad*n_clad), u: "無量綱", tag:["高三","光學"] },
    { t: "雷射光相干長度（概念）", q: ()->`相干長度代表什麼？`, a: ()=>`光波保持固定相位關係的距離尺度`, u: "描述", tag:["高三","光學"] },
    { t: "光學解析度（阿貝）", q: (lambda,NA)=>`波長 ${lambda} m 數值孔徑 NA，解析度近似為何？`, a: (lambda,NA)=>0.61*lambda/NA, u: "m", tag:["高三","光學"] },
    { t: "雷達方程（簡述）", q: ()->`雷達方程描述什麼？`, a: ()=>`回波功率與目標截面、距離與系統參數相關`, u: "描述", tag:["高三","波動"] },

    { t: "熱擴散長度（概念）", q: (k,rho,c,t)=>`熱擴散長度與哪些參數相關？`, a: (k,rho,c,t)=>`與熱擴散係數 α=k/(rho*c) 及時間 t 有關，長度 ~ sqrt(α t)`, u: "描述", tag:["高三","熱學"] },
    { t: "光電池效率（簡述）", q: (Pin,Pout)=>`輸入光功率 ${Pin} W 輸出電功率 ${Pout} W，效率為何？`, a: (Pin,Pout)=>Pout/Pin, u: "無量綱", tag:["高三","能源"] },
    { t: "超導臨界溫度（概念）", q: ()->`超導體臨界溫度代表什麼？`, a: ()=>`低於此溫度電阻降為零並出現抗磁性`, u: "描述", tag:["高三","凝態物理"] },
    { t: "霍爾效應（簡述）", q: (I,B,t,n)=>`電流 I 磁場 B 板厚 t 電荷密度 n，霍爾電壓與哪些量相關？`, a: (I,B,t,n)=>`與 I,B 成正比，與 n,t 成反比`, u: "描述", tag:["高三","電磁"] },

    { t: "聲音在不同介質速度比較", q: ()->`聲速在氣體、液體、固體中如何變化？`, a: ()=>`固體>液體>氣體（一般情況）`, u: "描述", tag:["高二","波動"] },
    { t: "光在不同介質折射方向", q: (n1,n2)=>`若 n2>n1，光由 n1 進入 n2，折射方向如何？`, a: (n1,n2)=>`折向法線（速度減小）`, u: "描述", tag:["高一","光學"] },
    { t: "電路短路電流估算", q: (V,R)=>`電源電壓 ${V} V，內阻或負載 R=${R} Ω，短路電流為何？`, a: (V,R)=>V/R, u: "A", tag:["高三","電路"] },
    { t: "電池能量密度（簡述）", q: ()->`能量密度代表什麼？`, a: ()=>`單位質量或體積所儲存的能量`, u: "描述", tag:["高三","能源"] },

    { t: "光的干涉（楊氏雙縫）", q: (d,D,lambda,m)=>`雙縫間距 d=${d} m 屏距 D=${D} m 波長 ${lambda} m 第 m 條亮紋位置為何？`, a: (d,D,lambda,m)=>m*lambda*D/d, u: "m", tag:["高三","光學"] },
    { t: "光學薄膜干涉（概念）", q: ()->`薄膜干涉條件為何？`, a: ()=>`光程差為波長的整數倍或半整數倍決定干涉型式`, u: "描述", tag:["高三","光學"] },
    { t: "電磁波能量傳輸（波束）", q: (I,A)=>`強度 I W/m² 穿過面積 A m²，功率為何？`, a: (I,A)=>I*A, u: "W", tag:["高三","波動"] },
    { t: "光學放大系統總放大率", q: (M1,M2)=>`兩級放大 M1 與 M2，總放大率為何？`, a: (M1,M2)=>M1*M2, u: "倍", tag:["高三","光學"] },

    { t: "電阻溫度補償（概念）", q: ()->`為何需要電阻溫度補償？`, a: ()=>`減少溫度變化對電路性能的影響`, u: "描述", tag:["高二","電學"] },
    { t: "熱電偶輸出（簡述）", q: (dT,S)=>`溫差 dT Seebeck 系數 S，熱電偶電壓為何？`, a: (dT,S)=>S*dT, u: "V", tag:["高三","熱學"] },
    { t: "光學濾波（概念）", q: ()->`光學濾波器的功能為何？`, a: ()=>`選擇性通過或阻擋特定波長的光`, u: "描述", tag:["高三","光學"] },
    { t: "聲音反射係數（簡述）", q: (Z1,Z2)=>`介面阻抗 Z1 與 Z2，反射係數為何？`, a: (Z1,Z2)=>Math.abs((Z2-Z1)/(Z2+Z1)), u: "無量綱", tag:["高三","波動"] },

    { t: "光學干涉條紋間距（概念）", q: ()->`干涉條紋間距受哪些參數影響？`, a: ()=>`波長、幾何距離與干涉裝置參數`, u: "描述", tag:["高三","光學"] },
    { t: "電磁波偏振（天線）", q: ()->`天線偏振與接收效率關係為何？`, a: ()=>`偏振匹配可提高接收效率，偏振不匹配會衰減`, u: "描述", tag:["高三","電磁"] },
    { t: "光學成像解析度與像差（概念）", q: ()->`像差會如何影響成像？`, a: ()=>`導致影像模糊、變形或色差`, u: "描述", tag:["高三","光學"] },
    { t: "量子躍遷（簡述）", q: ()->`電子躍遷時會發生什麼？`, a: ()=>`吸收或放出光子，能量差對應光子能量`, u: "描述", tag:["高三","量子"] }
];


        // 分年級註冊
        const grades = ["國八", "國九", "高一", "高二", "高三"];

        grades.forEach(grade => {
            const pool = phyDB.filter(q => q.tag[0] === grade);
            
            pool.forEach((p, idx) => {
                const templateId = `phy_${grade}_${idx}`;
                
                G.registerTemplate(templateId, (ctx, rnd) => {
                    const v1 = randInt(2, 9);
                    const v2 = randInt(2, 9);
                    const ans = p.a(v1, v2);
                    
                    const isInt = Number.isInteger(ans);
                    const opts = shuffle(generateNumericOptions(ans, isInt ? 'int' : 'float'));

                    return {
                        question: `【物理】${p.q(v1, v2)}`,
                        options: opts,
                        answer: opts.indexOf(ans),
                        concept: p.t,
                        explanation: [`正確答案：${ans} ${p.u}`]
                    };
                }, ["physics", "物理", "理化", "自然", grade, p.tag[1]]);
            });
        });

        console.log("✅ 物理題庫 (完整修復版) 已載入完成。");
    }

    init();

})(window);

(function(global){
    'use strict';
    console.log("ğŸŒ [Geography V9.0] åœ°ç†æ ¸å¿ƒé¡Œåº« (å…¨ç¯„åœè¦†è“‹ç‰ˆ) å•Ÿå‹•...");

    window.__GEOGRAPHY_REPO__ = window.__GEOGRAPHY_REPO__ || {};

    const Utils = {
        shuffle: (arr) => arr.sort(() => Math.random() - 0.5),
        rnd: (min, max) => Math.floor(Math.random() * (max - min + 1)) + min
    };

    // =================================================================
    // æ¨¡çµ„ A: åŸºç¤åœ°å½¢èˆ‡ä½ç½® (å°æ‡‰ åœ‹ä¸ƒ)
    // =================================================================
    const geoBasics = [
        {q: "å°ç£æœ¬å³¶çš„ç¶“ç·¯åº¦ä½ç½®ï¼Œå¤§ç´„ä»‹æ–¼ï¼Ÿ", a: "æ±ç¶“120~122åº¦ï¼ŒåŒ—ç·¯22~25åº¦", o:["æ±ç¶“130~135åº¦ï¼ŒåŒ—ç·¯30~40åº¦", "æ±ç¶“110~115åº¦ï¼ŒåŒ—ç·¯10~15åº¦", "è¥¿ç¶“120åº¦ï¼Œå—ç·¯23.5åº¦"], t:["ä½ç½®", "ç¶“ç·¯åº¦", "åœ‹ä¸ƒ"]},
        {q: "ä½æ–¼å°ç£æœ€å—ç«¯çš„å²¬è§’æ˜¯ï¼Ÿ", a: "éµé‘¾é¼»", o:["å¯Œè²´è§’", "ä¸‰è²‚è§’", "é¼»é ­è§’"], t:["ä½ç½®", "åœ‹ä¸ƒ"]},
        {q: "å°ç£äº”å¤§åœ°å½¢ä¸­ï¼Œåˆ†å¸ƒé¢ç©æœ€å»£çš„æ˜¯ï¼Ÿ", a: "å±±åœ°", o:["å¹³åŸ", "ä¸˜é™µ", "å°åœ°"], t:["åœ°å½¢", "åœ‹ä¸ƒ"]},
        {q: "ä¸‹åˆ—ä½•è€…å±¬æ–¼ã€å…§ç‡ŸåŠ›ã€é€ æˆçš„åœ°å½¢æ™¯è§€ï¼Ÿ", a: "ç«å±±å™´ç™¼å½¢æˆçš„éŒç‹€å±±é«”", o:["æ²³æµæ²–åˆ·å‡ºçš„å³½è°·", "é¢¨åŠ›å †ç©æˆçš„æ²™ä¸˜", "å†°æ²³ä¾µè•çš„Uå‹è°·"], t:["åœ°å½¢", "åœ‹ä¸ƒ"]},
        {q: "å°ç£ä¸»è¦çš„æ²³å·åˆ†æ°´å¶ºç‚ºï¼Ÿ", a: "ä¸­å¤®å±±è„ˆ", o:["é›ªå±±å±±è„ˆ", "é˜¿é‡Œå±±å±±è„ˆ", "æµ·å²¸å±±è„ˆ"], t:["æ°´æ–‡", "åœ‹ä¸ƒ"]}
    ];

    geoBasics.forEach((item, i) => {
        window.__GEOGRAPHY_REPO__[`geo_base_${i}`] = {
            func: () => {
                const opts = Utils.shuffle([item.a, ...item.o]);
                return {
                    question: `ã€åœ°ç†åŸºç¤ã€‘${item.q}`,
                    options: opts,
                    answer: opts.indexOf(item.a),
                    explanation: [`æ­£ç¢ºç­”æ¡ˆï¼š${item.a}`, `}]`], // è§¸ç™¼åœ–åƒ
                    subject: "geography", tags: ["geography", "åœ°ç†", ...item.t]
                };
            }, tags: ["geography", "åœ°ç†", ...item.t], subject: "geography"
        };
    });

    // =================================================================
    // æ¨¡çµ„ B: æ°£å€™åˆ¤è®€å·¥å»  (å°æ‡‰ åœ‹ä¸ƒ/åœ‹å…«/åœ‹ä¹)
    // =================================================================
    const climates = [
        {name: "ç†±å¸¶é›¨æ—", desc: "å…¨å¹´é«˜æº«å¤šé›¨ï¼Œç„¡æ˜é¡¯ä¹¾å­£", loc: "èµ¤é“é™„è¿‘ (å¦‚: äºé¦¬éœç›†åœ°)"},
        {name: "ç†±å¸¶æ²™æ¼ ", desc: "å…¨å¹´ä¹¾ç‡¥å°‘é›¨ï¼Œæ—¥æº«å·®å¤§", loc: "å›æ­¸ç·šé™„è¿‘ (å¦‚: æ’’å“ˆæ‹‰)"},
        {name: "åœ°ä¸­æµ·å‹", desc: "å¤ç†±ä¹¾ç‡¥ï¼Œå†¬æš–å¤šé›¨", loc: "ç·¯åº¦30-40åº¦å¤§é™¸è¥¿å²¸ (å¦‚: ç¾©å¤§åˆ©)"},
        {name: "æº«å¸¶æµ·æ´‹æ€§", desc: "çµ‚å¹´æº«å’Œæœ‰é›¨ï¼Œå¹´æº«å·®å°", loc: "ç·¯åº¦40-60åº¦å¤§é™¸è¥¿å²¸ (å¦‚: å€«æ•¦)"},
        {name: "ç†±å¸¶å­£é¢¨", desc: "å…¨å¹´é«˜æº«ï¼Œä¹¾æ¿•å­£åˆ†æ˜", loc: "äºæ´²å—éƒ¨ (å¦‚: å°ç£å—éƒ¨)"}
    ];

    for(let i=0; i<15; i++) {
        const c = climates[i % climates.length];
        const id = `geo_clim_fac_${i}`;
        // åŠ ä¸Šå¤šå€‹å¹´ç´šæ¨™ç±¤ç¢ºä¿éƒ½èƒ½æŠ“åˆ°
        const tags = ["geography", "åœ°ç†", "æ°£å€™", "åœ‹ä¸ƒ", "åœ‹å…«", "åœ‹ä¹"]; 

        const func = () => {
            const others = Utils.shuffle(climates.filter(x => x.name !== c.name)).slice(0, 3).map(x => x.name);
            const opts = Utils.shuffle([c.name, ...others]);
            return {
                question: `ã€æ°£å€™åˆ¤è®€ã€‘æŸåœ°å€çš„æ°£å€™ç‰¹å¾µç‚ºã€Œ${c.desc}ã€ï¼Œè©²åœ°æœ€å¯èƒ½å±¬æ–¼å“ªç¨®æ°£å€™é¡å‹ï¼Ÿ`,
                options: opts,
                answer: opts.indexOf(c.name),
                explanation: [
                    `ç‰¹å¾µï¼š${c.desc}`,
                    `åˆ†å¸ƒç¯„ä¾‹ï¼š${c.loc}`,
                    ``
                ],
                subject: "geography", tags: tags
            };
        };
        window.__GEOGRAPHY_REPO__[id] = { func, tags, subject: "geography" };
    }

    // =================================================================
    // æ¨¡çµ„ C: å€åŸŸåœ°ç†èˆ‡ç”¢æ¥­ (å°æ‡‰ åœ‹å…«/åœ‹ä¹/é«˜ä¸­)
    // =================================================================
    const regions = [
        {q: "ä»¥ã€è»Ÿé«”ä»£å·¥ã€èåï¼Œæœ‰ä¸–ç•Œè¾¦å…¬å®¤ä¹‹ç¨±çš„åœ‹å®¶ï¼Ÿ", a: "å°åº¦", o:["ä¸­åœ‹", "å·´è¥¿", "ä¿„ç¾…æ–¯"], t:["å—äº", "åœ‹å…«"]},
        {q: "æ±å—äºåœ‹å”ä¸­ï¼Œå”¯ä¸€çš„å…§é™¸åœ‹å®¶æ˜¯ï¼Ÿ", a: "å¯®åœ‹", o:["æ³°åœ‹", "è¶Šå—", "æŸ¬åŸ”å¯¨"], t:["æ±å—äº", "åœ‹å…«"]},
        {q: "ç¾åœ‹çš„é«˜ç§‘æŠ€ç”¢æ¥­æ ¸å¿ƒã€çŸ½è°·ã€ä½æ–¼ä½•è™•ï¼Ÿ", a: "åŠ å· (èˆŠé‡‘å±±ç£å€)", o:["ç´ç´„", "å¾·å·", "è¥¿é›…åœ–"], t:["åŒ—ç¾", "åœ‹ä¹"]},
        {q: "ä¸‹åˆ—å“ªå€‹çµ„ç¹”æ˜¯ç›®å‰æ­æ´²æ•´åˆç¨‹åº¦æœ€é«˜çš„å€åŸŸçµ„ç¹”ï¼Ÿ", a: "æ­ç›Ÿ (EU)", o:["åŒ—ç´„ (NATO)", "æ­å®‰çµ„ç¹”", "æ­æ´²è­°æœƒ"], t:["æ­æ´²", "åœ‹ä¹"]},
        {q: "å°ç£çš„äººå£åˆ†ä½ˆå‘ˆç¾ä»€éº¼ç‰¹å¾µï¼Ÿ", a: "è¥¿éƒ¨å¤šæ–¼æ±éƒ¨ï¼Œå¹³åŸå¤šæ–¼å±±åœ°", o:["æ±éƒ¨å¤šæ–¼è¥¿éƒ¨", "å±±åœ°å¤šæ–¼å¹³åŸ", "å—åŒ—å¹³å‡"], t:["äººå£", "åœ‹ä¸ƒ", "åœ‹å…«"]}
    ];

    regions.forEach((item, i) => {
        const id = `geo_reg_${i}`;
        const tags = ["geography", "åœ°ç†", ...item.t];
        window.__GEOGRAPHY_REPO__[id] = {
            func: () => {
                const opts = Utils.shuffle([item.a, ...item.o]);
                return {
                    question: `ã€å€åŸŸåœ°ç†ã€‘${item.q}`,
                    options: opts,
                    answer: opts.indexOf(item.a),
                    explanation: [`æ­£ç¢ºç­”æ¡ˆï¼š${item.a}`, `}]`],
                    subject: "geography", tags: tags
                };
            }, tags, subject: "geography"
        };
    });

})(window);

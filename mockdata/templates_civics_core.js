(function(global){
    'use strict';
    console.log("⚖️ [Civics V9.0] 公民工廠：正在生產 50 道試題...");
    window.__CIVICS_REPO__ = window.__CIVICS_REPO__ || {};
    const U = { shuffle: (arr) => arr.sort(() => Math.random() - 0.5) };

    const cats = {
        "社會": [
            {q:"性別刻板印象",a:"男主外女主內"}, {q:"家庭功能",a:"生育與教養"}, {q:"社會化",a:"學習社會規範"},
            {q:"各種團體",a:"志願結社"}, {q:"社區意識",a:"認同感"}, {q:"社會流動",a:"改變階級"},
            {q:"社會福利",a:"照顧弱勢"}, {q:"多元文化",a:"尊重差異"}, {q:"性騷擾",a:"不受歡迎的舉動"}, {q:"家庭暴力",a:"撥打113"}
        ],
        "政治": [
            {q:"國家要素",a:"人民領土政府主權"}, {q:"民主政治",a:"主權在民"}, {q:"政黨功能",a:"推薦候選人"},
            {q:"利益團體",a:"遊說"}, {q:"選舉原則",a:"普通平等直接無記名"}, {q:"公民投票",a:"直接民權"},
            {q:"立法院",a:"制定法律"}, {q:"行政院",a:"執行政策"}, {q:"司法院",a:"解釋憲法"}, {q:"監察院",a:"彈劾糾舉"}
        ],
        "法律": [
            {q:"憲法",a:"最高性"}, {q:"法律",a:"立法院通過"}, {q:"命令",a:"行政機關訂定"},
            {q:"權利救濟",a:"訴訟"}, {q:"民法",a:"私法自治"}, {q:"刑法",a:"罪刑法定"},
            {q:"行政法",a:"依法行政"}, {q:"調解",a:"法院或公所"}, {q:"和解",a:"契約效力"}, {q:"法官",a:"獨立審判"}
        ],
        "經濟": [
            {q:"機會成本",a:"放棄價值最高者"}, {q:"需求法則",a:"價漲量縮"}, {q:"供給法則",a:"價漲量增"},
            {q:"市場均衡",a:"供需相等"}, {q:"生產要素",a:"土地勞力資本企業"}, {q:"貨幣功能",a:"交易媒介"},
            {q:"通貨膨脹",a:"物價持續上漲"}, {q:"GDP",a:"國內生產毛額"}, {q:"外部效果",a:"成本轉嫁他人"}, {q:"公共財",a:"無法排他"}
        ],
        "全球": [
            {q:"全球化",a:"天涯若比鄰"}, {q:"WTO",a:"世界貿易組織"}, {q:"WHO",a:"世界衛生組織"},
            {q:"聯合國",a:"維護和平"}, {q:"歐盟",a:"區域統合"}, {q:"國際分工",a:"比較利益"},
            {q:"貧富差距",a:"南北問題"}, {q:"氣候變遷",a:"節能減碳"}, {q:"人權議題",a:"國際特赦組織"}, {q:"文化交流",a:"創新與融合"}
        ]
    };

    let count = 0;
    for(let c in cats) {
        cats[c].forEach(item => {
            const id = `civ_auto_${count++}`;
            const tags = ["civics", "公民", "社會", c];
            window.__CIVICS_REPO__[id] = {
                func: () => {
                    const wr = U.shuffle(cats[c].filter(x=>x.a!==item.a)).slice(0,3).map(x=>x.a);
                    const opts = U.shuffle([item.a, ...wr]);
                    return { question: `【${c}】關於「${item.q}」，下列何者正確？`, options: opts, answer: opts.indexOf(item.a), explanation: [`正確答案：${item.a}`, ``], subject: "civics", tags };
                }, tags, subject: "civics"
            };
        });
    }
})(window);

(function(global){
    'use strict';
    console.log("⚖️ [Civics V9.5] 公民科精準對齊版 (含心理/法律/經濟/政治) 啟動...");
    window.__CIVICS_REPO__ = window.__CIVICS_REPO__ || {};

    const Utils = { shuffle: (arr) => arr.sort(() => Math.random() - 0.5) };

    // ==========================================
    // 1. 國七：自我與社會 (對應課綱：自我, 性別, 家庭, 社區)
    // ==========================================
    const social = [
        {q:"根據馬斯洛需求理論，最高層次的需求是？", a:"自我實現", o:["尊重需求","愛與隸屬","生理需求"], t:["自我","國七"]},
        {q:"對於性別角色的看法，下列何者符合性別平等觀念？", a:"尊重個人的特質與選擇", o:["男主外女主內","女生不適合讀理科","男生不能哭"], t:["性別","國七"]},
        {q:"由一對夫妻及其未婚子女組成的家庭型態是？", a:"小家庭 (核心家庭)", o:["折衷家庭","大家庭","單親家庭"], t:["家庭","國七"]},
        {q:"社區營造的主要目的是？", a:"凝聚居民共識，改善生活環境", o:["提高房價","增加商業利益","應付政府檢查"], t:["社區","國七"]}
    ];
    social.forEach((item,i) => register(item, `civ_soc_${i}`));

    // ==========================================
    // 2. 國八：政治與法律 (對應課綱：國家, 政治, 法律, 民法, 刑法)
    // ==========================================
    const politics = [
        {q:"國家的組成要素中，最具排他性與最高性的是？", a:"主權", o:["人民","領土","政府"], t:["國家","國八"]},
        {q:"我國負責解釋憲法、統一解釋法律的機關是？", a:"司法院 (大法官)", o:["立法院","行政院","最高法院"], t:["政治","五權分立","國八"]},
        {q:"依據《民法》，滿幾歲為完全行為能力人？", a:"18歲", o:["20歲","16歲","7歲"], t:["法律","民法","國八"]},
        {q:"刑法對於「責任能力」的規定，未滿14歲之行為？", a:"不罰", o:["得減輕其刑","需負完全責任","由父母代罰"], t:["法律","刑法","國八"]}
    ];
    politics.forEach((item,i) => register(item, `civ_pol_${i}`));

    // ==========================================
    // 3. 國九：經濟與全球 (對應課綱：經濟, 機會成本, 全球化)
    // ==========================================
    const econ = [
        {q:"魚與熊掌不可兼得，在做選擇時放棄價值最高者稱為？", a:"機會成本", o:["生產成本","沉沒成本","外部成本"], t:["經濟","機會成本","國九"]},
        {q:"根據需求法則，當商品價格下跌時？", a:"需求量增加", o:["需求量減少","供給量增加","需求不變"], t:["經濟","供需","國九"]},
        {q:"為了促進世界貿易自由化而成立的國際組織是？", a:"世界貿易組織 (WTO)", o:["世界衛生組織 (WHO)","亞太經合會 (APEC)","歐盟 (EU)"], t:["全球","全球化","國九"]},
        {q:"下列何者屬於公共財的特性？", a:"無法排他性", o:["獨佔性","競爭性","可分割性"], t:["經濟","國九"]}
    ];
    econ.forEach((item,i) => register(item, `civ_eco_${i}`));

    // ==========================================
    // 4. 高中：進階公民 (對應課綱：人權, 憲法, 經濟)
    // ==========================================
    const highCiv = [
        {q:"憲法保障人民的基本權利，若要限制必須符合？", a:"比例原則 (公益、必要、法律保留)", o:["多數決原則","效率原則","行政指導"], t:["憲法","人權","高一"]},
        {q:"政府對違法行政行為造成人民損害時，人民可請求？", a:"國家賠償", o:["損失補償","社會救助","犯罪被害補償"], t:["行政法","高一"]},
        {q:"國內生產毛額 (GDP) 是指一國在特定期間內生產的？", a:"最終產品與勞務的市價總值", o:["中間產品總值","國民所得毛額","地下經濟總值"], t:["經濟","高二"]},
        {q:"為了保障弱勢群體，在此範圍內給予差別待遇，稱為？", a:"實質平等 (優惠性差別待遇)", o:["形式平等","齊頭式平等","絕對平等"], t:["人權","公益","高一"]}
    ];
    highCiv.forEach((item,i) => register(item, `civ_high_${i}`));

    // --- 註冊 helper ---
    function register(item, id) {
        const finalTags = ["civics", "公民", ...item.t];
        window.__CIVICS_REPO__[id] = {
            func: () => {
                const opts = Utils.shuffle([item.a, ...item.o]);
                return {
                    question: `【公民】${item.q}`,
                    options: opts, answer: opts.indexOf(item.a),
                    explanation: [`正確答案：${item.a}`, `} concept]`],
                    subject: "civics", tags: finalTags
                };
            }, tags: finalTags, subject: "civics"
        };
    }
})(window);

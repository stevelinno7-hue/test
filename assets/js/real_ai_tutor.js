/* =====================================================
 * ç¿°æ— AI åŠ©æ•™ (æ¨¡æ“¬å›æ‡‰ç‰ˆ - ç„¡éœ€ API Key)
 * ===================================================== */

const RealAITutor = {

    /* ===============================
     * åŸºæœ¬è¨­å®š
     * =============================== */
    name: "å­¸é™¢ AI åŠ©æ•™ ",
    gradeLevel: "senior",
    teacherMode: true,

    /* ===============================
     * ç‹€æ…‹è¿½è¹¤
     * =============================== */
    history: [],
    
    /* ===============================
     * æ¨¡æ“¬ AI å¤§è…¦ (é—œéµå­—è¦å‰‡åº«)
     * =============================== */
    generateMockResponse(title, content) {
        const text = (title + content).toLowerCase();
        let response = "";

        // å…±ç”¨é–‹é ­
        const header = `ğŸ“˜ **ã€å­¸é™¢ AI åŠ©æ•™ã€‘**\n\nåŒå­¸ä½ å¥½ï¼å¾ˆé«˜èˆˆèƒ½å”åŠ©ä½ è§£æ±ºé€™å€‹å•é¡Œã€‚\n\n`;

        // 1. æ•¸å­¸é¡
        if (text.match(/æ•¸å­¸|è¨ˆç®—|å¹¾ä½•|å‡½æ•¸|æ–¹ç¨‹å¼|ä¸‰è§’å½¢|åœ“å½¢/)) {
            response = `${header}é€™æ˜¯ä¸€å€‹å¾ˆç¶“å…¸çš„**æ•¸å­¸è§€å¿µé¡Œ**ï¼æˆ‘å€‘è©¦è‘—ç”¨ã€Œæ‹†è§£æ³•ã€ä¾†æ€è€ƒï¼š

1.  **ç¢ºèªå·²çŸ¥æ¢ä»¶**ï¼š
    * é¡Œç›®çµ¦äº†å“ªäº›æ•¸å€¼ï¼Ÿ
    * ç›®æ¨™æ˜¯æ±‚ä»€éº¼ï¼Ÿ
2.  **è¯æƒ³å…¬å¼**ï¼š
    * çœ‹åˆ°é€™å€‹åœ–å½¢/ç®—å¼ï¼Œä½ æœƒæƒ³åˆ°èª²æœ¬æ•™éçš„å“ªå€‹å®šç†ï¼Ÿ
    * (æç¤ºï¼šè©¦è‘—å›æƒ³ä¸€ä¸‹ç›¸é—œçš„å®šç¾©)
3.  **é€æ­¥è¨ˆç®—**ï¼š
    * ä¸è¦æ€¥è‘—è·³åˆ°ç­”æ¡ˆï¼Œå…ˆåˆ—å‡ºç®—å¼ã€‚
    * æ³¨æ„æ­£è² è™Ÿé‹ç®—ã€‚

ğŸ’¡ **å°æ’‡æ­¥**ï¼šä½ å¯ä»¥è©¦è‘—ç•«å‡ºè¼”åŠ©ç·šï¼Œæˆ–æ˜¯å¸¶å…¥ç°¡å–®çš„æ•¸å­—é©—ç®—çœ‹çœ‹å–”ï¼`;
        }
        // 2. è‹±æ–‡é¡
        else if (text.match(/è‹±æ–‡|å–®å­—|æ–‡æ³•|ç¿»è­¯|å¥å‹|english/)) {
            response = `${header}é€™æ˜¯ä¸€å€‹é—œæ–¼**è‹±èªæ‡‰ç”¨**çš„å¥½å•é¡Œï¼èªè¨€å­¸ç¿’é‡è¦–èªæ„Ÿèˆ‡è¦å‰‡çš„çµåˆã€‚

* **å–®å­—è§£æ**ï¼š
    * é€™å€‹å­—æ˜¯å¦æœ‰å…¶ä»–è©æ€§è®ŠåŒ–ï¼Ÿ
    * è©¦è‘—ç”¨å®ƒé€ ä¸€å€‹ç°¡å–®çš„å¥å­ã€‚
* **æ–‡æ³•é‡é»**ï¼š
    * æ³¨æ„æ™‚æ…‹ï¼ˆç¾åœ¨/éå»/å®Œæˆå¼ï¼‰ã€‚
    * ä¸»è©èˆ‡å‹•è©çš„ä¸€è‡´æ€§ (Subject-Verb Agreement)ã€‚

ğŸ¯ **å»ºè­°**ï¼šå¤šæœ—è®€å¹¾æ¬¡å¥å­ï¼Œä½ æœƒç™¼ç¾ç­”æ¡ˆå¾€å¾€å°±åœ¨èªæ„Ÿé †æš¢çš„åœ°æ–¹å–”ï¼`;
        }
        // 3. ç†åŒ–/ç§‘å­¸é¡
        else if (text.match(/ç‰©ç†|åŒ–å­¸|ç”Ÿç‰©|åœ°ç§‘|ç†åŒ–|åŠ›å­¸|åæ‡‰|ç´°èƒ/)) {
            response = `${header}é€™æ˜¯ä¸€å€‹æœ‰è¶£çš„**ç§‘å­¸ç¾è±¡**ï¼è®“æˆ‘å€‘åƒç§‘å­¸å®¶ä¸€æ¨£ä¾†è§€å¯Ÿï¼š

1.  **ç¾è±¡åˆ†æ**ï¼š
    * é¡Œç›®æè¿°çš„éç¨‹ç™¼ç”Ÿäº†ä»€éº¼è®ŠåŒ–ï¼Ÿ
    * è®Šå› æ˜¯ä»€éº¼ï¼Ÿ(æ§åˆ¶è®Šå›  vs æ“ä½œè®Šå› )
2.  **åŸç†æ‡‰ç”¨**ï¼š
    * é€™è·Ÿæˆ‘å€‘å­¸éçš„å“ªå€‹å®šå¾‹æœ‰é—œï¼Ÿ(ä¾‹å¦‚ï¼šç‰›é “å®šå¾‹ã€èƒ½é‡å®ˆæ†)
3.  **é‚è¼¯æ¨æ¼”**ï¼š
    * å› ç‚º A ç™¼ç”Ÿäº†ï¼Œæ‰€ä»¥å°è‡´ B...

ğŸ”¬ **æ€è€ƒçœ‹çœ‹**ï¼šå¦‚æœæŠŠæ¢ä»¶åéä¾†ï¼Œçµæœæœƒä¸€æ¨£å—ï¼Ÿ`;
        }
        // 4. æ­·å²/ç¤¾æœƒé¡
        else if (text.match(/æ­·å²|åœ°ç†|å…¬æ°‘|ç¤¾æœƒ|å¹´ä»£|æˆ°çˆ­|æ³•å¾‹/)) {
            response = `${header}é€™æ˜¯ä¸€å€‹éœ€è¦**å®è§€è¦–é‡**çš„ç¤¾æœƒç§‘å•é¡Œã€‚

* **æ™‚ç©ºèƒŒæ™¯**ï¼š
    * é€™ä»¶äº‹ç™¼ç”Ÿåœ¨ä»€éº¼å¹´ä»£ï¼Ÿç•¶æ™‚çš„ä¸–ç•Œå±€å‹¢å¦‚ä½•ï¼Ÿ
    * åœ°ç†ç’°å¢ƒå¦‚ä½•å½±éŸ¿äº†é€™å€‹äº‹ä»¶ï¼Ÿ
* **é—œéµäººç‰©/æ³•æ¢**ï¼š
    * èª°æ˜¯ä¸»è¦è§’è‰²çš„ï¼Ÿä»–çš„å‹•æ©Ÿæ˜¯ä»€éº¼ï¼Ÿ
    * é€™æ¶‰åŠåˆ°äº†å“ªäº›æ¬Šåˆ©èˆ‡ç¾©å‹™ï¼Ÿ

ğŸŒ **è§€å¿µé€£çµ**ï¼šæ­·å²ä¸æ˜¯èƒŒèª¦å¹´ä»£ï¼Œè€Œæ˜¯ç†è§£ã€Œå› æœé—œä¿‚ã€ã€‚è©¦è‘—ç”¨èªªæ•…äº‹çš„æ–¹å¼æŠŠè„ˆçµ¡ä¸²èµ·ä¾†å§ï¼`;
        }
        // 5. é è¨­é€šç”¨å›ç­”
        else {
            response = `${header}é€™æ˜¯ä¸€å€‹å¾ˆæ£’çš„æå•ï¼é›–ç„¶æˆ‘æš«æ™‚ç„¡æ³•åˆ¤æ–·å…·é«”ç§‘ç›®ï¼Œä½†æˆ‘å»ºè­°ä½ å¯ä»¥é€™æ¨£æ€è€ƒï¼š

1.  **é‡æ¸…é¡Œæ„**ï¼šé¡Œç›®æœ€æ ¸å¿ƒçš„é—œéµå­—æ˜¯ä»€éº¼ï¼Ÿ
2.  **åˆªå»æ³•**ï¼šå¦‚æœæ˜¯é¸æ“‡é¡Œï¼Œå…ˆæŠŠæ˜é¡¯éŒ¯èª¤çš„é¸é …åˆªæ‰ã€‚
3.  **å›æ­¸èª²æœ¬**ï¼šé€™é¡Œçœ‹èµ·ä¾†åƒæ˜¯å“ªå€‹ç« ç¯€çš„è®Šå½¢ï¼Ÿ

ä½ å¯ä»¥è©¦è‘—è£œå……æ›´å¤šç´°ç¯€ï¼Œæˆ‘èƒ½çµ¦ä½ æ›´ç²¾æº–çš„å»ºè­°å–”ï¼ğŸ’ª`;
        }

        return response;
    },

    /* ===============================
     * ä¸»è¦å…¥å£ï¼šaskGemini
     * (ä¿ç•™å‡½å¼åç¨±ï¼Œè®“ forum.html å¯ä»¥ç›´æ¥å‘¼å«)
     * =============================== */
    async askGemini(title, content) {
        console.log("ğŸ§  æ¨¡æ“¬ AI æ­£åœ¨æ€è€ƒ...", title);

        // 1. æ¨¡æ“¬ç¶²è·¯å»¶é² (1.5ç§’)ï¼Œè®“é«”é©—æ›´çœŸå¯¦
        await new Promise(resolve => setTimeout(resolve, 1500));

        // 2. ç”¢ç”Ÿå‡å›ç­”
        const aiResponse = this.generateMockResponse(title, content);

        // 3. è¨˜éŒ„æ­·å²
        this.history.push({ 
            q: title + " - " + content, 
            a: aiResponse, 
            time: new Date() 
        });

        // 4. å›å‚³çµæœ
        return aiResponse;
    }
};
